<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<title>Create | SN Design Studio</title>

<!-- MASTER LOCK -->
<link rel="stylesheet" href="/assets/css/master.css">

<!-- CREATE ONLY CSS -->
<link rel="stylesheet" href="/assets/css/create.css">

</head>

<body class="create-page">

<div class="container">

<h1 id="engineName">ENGINE: LOADING...</h1>

<select id="modelSelect"></select>

<input id="promptBox" placeholder="Enter prompt">

<button id="generateBtn">GENERATE</button>

<div class="progress">
<div id="progressBar"></div>
</div>

<div id="statusText">STATUS: IDLE</div>

</div>

<script>

/* =====================================================
   TEMPLATE â†’ MODEL MAPPING (FINAL SYSTEM)
===================================================== */

const TEMPLATE_MODELS = {

   "dark-viral": {
      replicate:"flux2pro",
      runway:"gen4-darkviral"
   },

   "lipsync": {
      replicate:"flux2pro-lipsync",
      runway:"gen4-lipsync"
   },

   "dance-motion": {
      replicate:"flux2pro-motion",
      runway:"gen4-motion"
   },

   "face-swap": {
      replicate:"flux2pro-faceswap",
      runway:"gen4-faceswap"
   }

};


/* =====================================================
   GET TEMPLATE FROM URL
===================================================== */

const params = new URLSearchParams(window.location.search);
const template = params.get("template");


/* =====================================================
   UI REFERENCES
===================================================== */

const modelSelect = document.getElementById("modelSelect");
const engineName = document.getElementById("engineName");
const statusText = document.getElementById("statusText");
const progressBar = document.getElementById("progressBar");
const generateBtn = document.getElementById("generateBtn");


/* =====================================================
   BUILD MODEL SELECT (LEFT RED = REPLICATE / RIGHT BLUE = RUNWAY)
===================================================== */

function buildModelList(){

   if(!template || !TEMPLATE_MODELS[template]){
      engineName.innerText = "ENGINE: UNKNOWN TEMPLATE";
      return;
   }

   const models = TEMPLATE_MODELS[template];

   modelSelect.innerHTML = `
      <option value="${models.replicate}" data-engine="replicate">
         ðŸ”´ Replicate â€” ${models.replicate}
      </option>

      <option value="${models.runway}" data-engine="runway">
         ðŸ”µ RunwayML â€” ${models.runway}
      </option>
   `;

   updateEngineLabel();

}

function updateEngineLabel(){

   const selected = modelSelect.options[modelSelect.selectedIndex];
   const engine = selected.dataset.engine;

   engineName.innerText =
      engine === "replicate"
      ? "ENGINE: REPLICATE AI"
      : "ENGINE: RUNWAY GEN4";

}

modelSelect.addEventListener("change",updateEngineLabel);


/* =====================================================
   GENERATE BUTTON
===================================================== */

generateBtn.addEventListener("click", async ()=>{

   const model = modelSelect.value;
   const prompt = document.getElementById("promptBox").value;

   if(!model){
      alert("No model selected");
      return;
   }

   statusText.innerText = "STATUS: PROCESSING...";
   progressBar.style.width = "20%";

   try{

      const res = await fetch("/api/render",{
         method:"POST",
         headers:{
            "Content-Type":"application/json"
         },
         body:JSON.stringify({
            model:model,
            prompt:prompt
         })
      });

      progressBar.style.width = "70%";

      const data = await res.json();

      progressBar.style.width = "100%";

      statusText.innerText = "STATUS: COMPLETE";

   }catch(e){

      console.log(e);
      statusText.innerText = "STATUS: ERROR";

   }

});


/* =====================================================
   INIT
===================================================== */

buildModelList();

</script>

</body>
</html>
