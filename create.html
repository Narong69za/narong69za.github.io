<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<title>Create | SN Design Studio</title>

<link rel="stylesheet" href="https://api.sn-designstudio.dev/assets/css/master.css">
<link rel="stylesheet" href="https://api.sn-designstudio.dev/assets/css/create.css">

</head>

<body>

<div class="create-wrapper">

<!-- ================= TOP PANEL ================= -->

<div class="create-top">

<h1 class="create-title">ULTRA GOD CREATE</h1>

<div id="engineLabel"></div>

<div class="create-info">

<div>MAX LENGTH: 30 sec</div>
<div>MODE: AI ENGINE</div>
<div>STATUS: READY</div>

</div>

</div>

<!-- ================= INPUT ================= -->

<textarea id="prompt" placeholder="Enter prompt"></textarea>

<!-- ================= UPLOAD ================= -->

<input type="file" id="uploadMedia" accept="video/*,image/*" hidden>

<button id="uploadBtn">ADD MEDIA</button>

<!-- ================= CTA ================= -->

<button id="createBtn">CREATE VIDEO</button>

<!-- ================= STATUS ================= -->

<div id="statusTop">STATUS: IDLE</div>

<div class="progress-wrap">
<div id="progressBar"></div>
</div>

<!-- ================= PREVIEW ================= -->

<div id="preview"></div>

</div>


<script>

/* ================= CONFIG ================= */

const API =
(window.SN_CONFIG && window.SN_CONFIG.API_BASE)
? window.SN_CONFIG.API_BASE
: "https://api.sn-designstudio.dev";


/* ================= ELEMENTS ================= */

const params = new URLSearchParams(location.search);
const templateID = params.get("template");

const promptInput = document.getElementById("prompt");
const createBtn = document.getElementById("createBtn");
const engineLabel = document.getElementById("engineLabel");
const statusTop = document.getElementById("statusTop");
const progressBar = document.getElementById("progressBar");
const previewBox = document.getElementById("preview");


/* ================= INIT CHECK ================= */

if(!templateID){

statusTop.textContent="STATUS: TEMPLATE MISSING";
throw new Error("Template missing");

}

engineLabel.textContent = "ENGINE: "+templateID;


/* ================= UPLOAD ================= */

document.getElementById("uploadBtn").onclick = ()=>{

document.getElementById("uploadMedia").click();

};


/* ================= PROGRESS ================= */

function setProgress(val){

progressBar.style.width = val+"%";

}


/* ================= CREATE ================= */

createBtn.onclick = async ()=>{

const prompt = promptInput.value || "";

if(!prompt.trim()){

alert("Enter prompt first");
return;

}

statusTop.textContent="STATUS: SENDING";
setProgress(10);

try{

const res = await fetch(API+"/api/render",{

method:"POST",
headers:{ "Content-Type":"application/json" },

body:JSON.stringify({

templateID: templateID,
input:{ prompt:prompt }

})

});

const data = await res.json();

if(!data.jobID){

statusTop.textContent="STATUS: ERROR";
console.error(data);
return;

}

statusTop.textContent="STATUS: PROCESSING";
setProgress(30);

startPolling(data.jobID);

}catch(err){

console.error(err);
statusTop.textContent="STATUS: ERROR";

}

};


/* ================= POLLING ================= */

function startPolling(jobID){

const loop = setInterval(async ()=>{

try{

const res = await fetch(API+"/api/status/"+jobID);
const data = await res.json();

if(data.progress){

setProgress(data.progress);

}

if(data.status === "complete"){

clearInterval(loop);

statusTop.textContent="STATUS: COMPLETE";
setProgress(100);

if(data.url){

previewBox.innerHTML =
'<video controls autoplay src="'+data.url+'"></video>';

}

}

if(data.status === "error"){

clearInterval(loop);
statusTop.textContent="STATUS: ERROR";

}

}catch(e){

console.error(e);

}

},3000);

}

</script>

</body>
</html>
