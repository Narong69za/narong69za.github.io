<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<title>Create | SN Design Studio</title>

<link rel="stylesheet" href="assets/css/master.css">

<style>

body{
background:#050505;
color:white;
font-family:Arial;
}

.container{
max-width:800px;
margin:auto;
padding:20px;
}

button{
background:#00ffc8;
border:none;
padding:14px;
width:100%;
font-weight:bold;
cursor:pointer;
}

#statusPanel{
position:fixed;
bottom:20px;
right:20px;
background:#000;
border:1px solid #00ffc8;
padding:14px;
font-size:12px;
z-index:9999;
min-width:240px;
}

</style>

</head>

<body>

<div class="container">

<h2>PROJECT DETAIL</h2>

<div id="projectBox">
Template: <span id="templateID">ai-lipsync</span><br>
Engine: motion-ai<br>
Max Length: 30 sec
</div>

<br>

<input type="file" id="fileInput" multiple>

<br><br>

<button id="createBtn">CREATE VIDEO</button>

</div>

<div id="statusPanel">SYSTEM READY</div>

<script>

/* ===================================
ULTRA FINAL SYSTEM
=================================== */

const API_RENDER="/api/render";
const API_STATUS="/api/status";

const statusPanel=document.getElementById("statusPanel");

function setStatus(html){
   statusPanel.innerHTML=html;
}

function uuid(){
 return "job-"+Date.now()+"-"+Math.random().toString(36).slice(2);
}

function collectFiles(){

   const inp=document.getElementById("fileInput");

   const arr=[];

   if(inp.files){

      for(let f of inp.files){

         arr.push({
            name:f.name,
            size:f.size,
            type:f.type
         });

      }

   }

   return arr;

}

/* ===================================
WATCH STATUS LOOP
=================================== */

async function watchStatus(jobID){

   setStatus("JOB CREATED<br>"+jobID);

   const loop=setInterval(async()=>{

      try{

         const r=await fetch(API_STATUS+"?id="+jobID,{
            credentials:"include"
         });

         const d=await r.json();

         setStatus(
            "JOB:"+jobID+
            "<br>Status:"+d.status+
            "<br>Progress:"+ (d.progress||0)+"%"
         );

         if(d.status==="complete"){

            clearInterval(loop);

            setStatus("RENDER COMPLETE<br>"+jobID);

         }

      }catch(e){

         console.log(e);

      }

   },2000);

}

/* ===================================
SEND RENDER JOB
=================================== */

async function sendJob(){

   const jobID=uuid();

   const files=collectFiles();

   setStatus("SENDING JOB...");

   try{

      const res=await fetch(API_RENDER,{

         method:"POST",

         headers:{
            "Content-Type":"application/json"
         },

         credentials:"include",

         body:JSON.stringify({

            jobID:jobID,
            templateID:"ai-lipsync",
            engine:"motion-ai",
            duration:30,
            files:files

         })

      });

      const data=await res.json();

      const realID=data.jobID||jobID;

      watchStatus(realID);

   }catch(err){

      setStatus("RENDER ERROR");

      console.error(err);

   }

}

document.getElementById("createBtn").addEventListener("click",(e)=>{

   e.preventDefault();

   sendJob();

});

</script>

</body>
</html>
