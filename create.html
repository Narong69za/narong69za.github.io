<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<title>Create | SN DESIGN STUDIO</title>

<link rel="stylesheet" href="https://api.sn-designstudio.dev/assets/css/master.css">
<link rel="stylesheet" href="https://api.sn-designstudio.dev/assets/css/create.css">

</head>

<body class="create-page">

<section class="section">
<div class="container">

<h1 class="section-title">ULTRA GOD CREATE</h1>

<!-- ================= PRESET CARD ================= -->

<div id="presetWrapper" class="sn-card preset-card">
<div class="preset-loading">Loading preset...</div>
</div>

<!-- ================= CREATE PANEL ================= -->

<div class="sn-card create-panel">

<div id="engineLabel" class="engine-label"></div>

<textarea id="prompt" placeholder="Enter prompt"></textarea>

<button id="createBtn" class="btn-primary">
CREATE VIDEO
</button>

<div class="progress-wrap">
<div id="progressBar"></div>
</div>

<div id="status" class="status-box">
STATUS: IDLE
</div>

</div>

<!-- ================= PREVIEW ================= -->

<div id="preview" class="sn-card preview-card"></div>

</div>
</section>

<script>

/* ================= CONFIG ================= */

const API =
(window.SN_CONFIG && window.SN_CONFIG.API_BASE)
? window.SN_CONFIG.API_BASE
: "https://api.sn-designstudio.dev";

const params = new URLSearchParams(location.search);
const templateID = params.get("template");

const presetWrapper = document.getElementById("presetWrapper");
const engineLabel = document.getElementById("engineLabel");
const statusBox = document.getElementById("status");
const progressBar = document.getElementById("progressBar");

/* ================= LOAD PRESET ================= */

async function loadPreset(){

if(!templateID){
presetWrapper.innerHTML="Preset not found";
return;
}

try{

const res = await fetch(API+"/api/templates/"+templateID);
const data = await res.json();

engineLabel.innerText="ENGINE: "+data.engine;

presetWrapper.innerHTML=`

<img src="${data.image}" class="preset-image">

<div class="preset-content">

<h3>${data.title}</h3>
<p>${data.description}</p>

<div class="preset-tags">
${data.tags.map(tag=>`<span class="tag">${tag}</span>`).join("")}
</div>

</div>

`;

}catch(e){

presetWrapper.innerHTML="Error loading preset";

}

}

loadPreset();

/* ================= CREATE ================= */

document.getElementById("createBtn").onclick=async()=>{

const prompt = document.getElementById("prompt").value;

if(!prompt.trim()){
alert("Enter prompt");
return;
}

statusBox.innerText="STATUS: SENDING";
progressBar.style.width="20%";

const res = await fetch(API+"/api/render",{

method:"POST",
headers:{ "Content-Type":"application/json" },
body:JSON.stringify({
templateID,
input:{ prompt }
})

});

const data = await res.json();

startPolling(data.jobID);

};

/* ================= POLLING ================= */

function startPolling(jobID){

const loop=setInterval(async()=>{

const res = await fetch(API+"/api/status/"+jobID);
const data = await res.json();

if(data.progress){
progressBar.style.width=data.progress+"%";
}

if(data.status==="complete"){

clearInterval(loop);

statusBox.innerText="STATUS: COMPLETE";

document.getElementById("preview").innerHTML=
`<video controls autoplay src="${data.url}"></video>`;

}

if(data.status==="error"){

clearInterval(loop);
statusBox.innerText="STATUS: ERROR";

}

},3000);

}

</script>

</body>
</html>
