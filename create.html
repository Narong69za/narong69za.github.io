<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Create | SN Design Studio</title>

<link rel="stylesheet" href="assets/css/create.css">

<style>

/* ULTRA GOD UI LAYER (ADD ONLY) */

body{
background:#000;
color:#fff;
margin:0;
font-family:Arial, sans-serif;
}

.header{
padding:20px;
font-size:22px;
font-weight:bold;
}

.wrapper{
display:flex;
flex-direction:column;
gap:20px;
padding:20px;
}

@media(min-width:900px){
.wrapper{
flex-direction:row;
}
}

.left-panel{
flex:1;
}

.right-panel{
flex:1;
background:#050505;
padding:20px;
}

input{
width:100%;
padding:15px;
background:#111;
border:1px solid #333;
color:#fff;
}

button{
width:100%;
background:#ff0033;
color:#fff;
border:none;
padding:18px;
font-size:18px;
font-weight:bold;
margin-top:10px;
}

#preview video{
width:100%;
margin-top:20px;
}

#debug{
background:#000;
border:1px solid #222;
padding:10px;
height:200px;
overflow:auto;
font-size:12px;
}

</style>

</head>
<body>

<div class="header">ULTRA GOD CREATE ENGINE</div>

<div class="wrapper">

<div class="left-panel">

<input id="prompt" placeholder="Enter prompt">

<button id="createBtn">CREATE VIDEO</button>

<h3 id="status">STATUS: IDLE</h3>

</div>

<div class="right-panel">

<div id="preview"></div>

<pre id="debug"></pre>

</div>

</div>

<script>

/* ================= CONFIG ================= */

const API = "https://api.sn-designstudio.dev";

/* ================= DEBUG ================= */

function log(msg){
document.getElementById("debug").textContent += msg+"\\n";
}

/* ================= TEMPLATE PARAM ================= */

const params = new URLSearchParams(window.location.search);
const template = params.get("template");

log("CREATE READY");
log("Template: "+template);

if(!template){

document.getElementById("status").textContent =
"STATUS: NO TEMPLATE";

throw new Error("Template missing");

}

/* ================= TEMPLATE MAP ================= */

const MODEL_MAP = {

"dark-viral":"dark-viral",
"ai-lipsync":"ai-lipsync",
"dance-motion":"dance-motion",
"face-swap":"face-swap"

};

const model = MODEL_MAP[template];

if(!model){

document.getElementById("status").textContent =
"STATUS: MODEL NOT FOUND";

throw new Error("Model not mapped");

}

/* ================= CTA ================= */

document.getElementById("createBtn")
.addEventListener("click", async ()=>{

log("CTA CLICKED");

const prompt =
document.getElementById("prompt").value;

document.getElementById("status")
.textContent="STATUS: SENDING...";

try{

const res = await fetch(API+"/api/render",{

method:"POST",
headers:{
"Content-Type":"application/json"
},

body:JSON.stringify({

templateID:model,
prompt:prompt

})

});

const data = await res.json();

log("Response: "+JSON.stringify(data));

if(!data.jobID){

throw new Error("No jobID");

}

document.getElementById("status")
.textContent="STATUS: PROCESSING";

startPolling(data.jobID);

}catch(e){

log("ERROR:"+e.message);

document.getElementById("status")
.textContent="STATUS: ERROR";

}

});

/* ================= POLLING ================= */

function startPolling(jobID){

log("Polling start: "+jobID);

const interval = setInterval(async()=>{

const res = await fetch(
API+"/api/status/"+jobID
);

const data = await res.json();

log("Progress:"+data.progress);

if(data.status==="complete"){

clearInterval(interval);

document.getElementById("status")
.textContent="STATUS: COMPLETE";

showPreview(data);

}

if(data.status==="error"){

clearInterval(interval);

document.getElementById("status")
.textContent="STATUS: ERROR";

}

},3000);

}

/* ================= PREVIEW ================= */

function showPreview(data){

if(!data.url) return;

document.getElementById("preview").innerHTML =

'<video controls autoplay src="'+data.url+'"></video>';

}

</script>

</body>
</html>
