<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<title>Create | SN Design Studio</title>

<link rel="stylesheet" href="https://api.sn-designstudio.dev/assets/css/master.css">
<link rel="stylesheet" href="https://api.sn-designstudio.dev/assets/css/create.css">

</head>
<body class="create-page">

<section class="section">

<div class="container">

<h1 class="section-title">ULTRA GOD CREATE</h1>

<!-- =====================
PRESET CARD
===================== -->

<div id="presetCard" class="sn-card"></div>

<!-- =====================
CREATE AREA
===================== -->

<div class="sn-card">

<div id="engineLabel"></div>

<input id="prompt" placeholder="Enter prompt">

<button id="createBtn" class="btn-primary">
CREATE VIDEO
</button>

<div class="progress-wrap">
<div id="progressBar"></div>
</div>

<h3 id="status">STATUS: IDLE</h3>

</div>

<div id="preview" class="sn-card"></div>

</div>
</section>

<script>

/* ======================
CONFIG
====================== */

const API =
(window.SN_CONFIG && window.SN_CONFIG.API_BASE)
? window.SN_CONFIG.API_BASE
: "https://api.sn-designstudio.dev";

const params = new URLSearchParams(location.search);
const templateID = params.get("template");

const statusBox = document.getElementById("status");
const progressBar = document.getElementById("progressBar");
const engineLabel = document.getElementById("engineLabel");

/* ======================
LOAD PRESET CARD
====================== */

async function loadPreset(){

if(!templateID) return;

const res = await fetch(API+"/api/templates/"+templateID);
const data = await res.json();

engineLabel.innerText="ENGINE: "+data.engine;

document.getElementById("presetCard").innerHTML=`

<img src="${data.image}" class="card-img">

<h3>${data.title}</h3>

<p>${data.description}</p>

<div class="tag-row">
${data.tags.map(t=>`<span>${t}</span>`).join("")}
</div>

`;

}

loadPreset();

/* ======================
CREATE VIDEO
====================== */

document.getElementById("createBtn").onclick=async()=>{

const prompt = document.getElementById("prompt").value;

if(!prompt.trim()){

alert("Enter prompt");

return;

}

statusBox.innerText="STATUS: SENDING";
progressBar.style.width="20%";

const res = await fetch(API+"/api/render",{

method:"POST",

headers:{ "Content-Type":"application/json" },

body:JSON.stringify({

templateID:templateID,

input:{ prompt }

})

});

const data = await res.json();

startPolling(data.jobID);

};

/* ======================
POLLING
====================== */

function startPolling(jobID){

const loop=setInterval(async()=>{

const res = await fetch(API+"/api/status/"+jobID);

const data = await res.json();

if(data.progress){

progressBar.style.width=data.progress+"%";

}

if(data.status==="complete"){

clearInterval(loop);

statusBox.innerText="STATUS: COMPLETE";

document.getElementById("preview").innerHTML=

`<video controls autoplay src="${data.url}"></video>`;

}

},3000);

}

</script>

</body>
</html>
