<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<title>Create | SN Design Studio</title>

<!-- MASTER CSS ONLY (LOCK) -->
<link rel="stylesheet" href="https://api.sn-designstudio.dev/assets/css/master.css">

</head>
<body>

<div class="create-wrapper">

<h1 class="create-title">ULTRA GOD CREATE</h1>

<h3 id="engineLabel"></h3>

<input id="prompt" class="create-input" placeholder="Enter prompt">

<button id="createBtn" class="create-btn">CREATE VIDEO</button>

<h3 id="status" class="status-box">STATUS: IDLE</h3>

<div id="preview" class="preview-box"></div>

</div>

<script>

/* =================================================
CONFIG
================================================= */

const API =
(window.SN_CONFIG && window.SN_CONFIG.API_BASE)
? window.SN_CONFIG.API_BASE
: "https://api.sn-designstudio.dev";

/* =================================================
ELEMENTS
================================================= */

const params = new URLSearchParams(location.search);
const templateID = params.get("template");

const promptInput = document.getElementById("prompt");
const createBtn = document.getElementById("createBtn");
const statusBox = document.getElementById("status");
const engineLabel = document.getElementById("engineLabel");
const previewBox = document.getElementById("preview");

/* =================================================
INIT CHECK
================================================= */

if(!templateID){

statusBox.textContent="STATUS: TEMPLATE MISSING";
throw new Error("Template not found");

}

engineLabel.textContent = "ENGINE: " + templateID;

/* =================================================
CREATE BUTTON
================================================= */

createBtn.addEventListener("click", async ()=>{

const prompt = promptInput.value.trim();

if(!prompt){
alert("Enter prompt first");
return;
}

statusBox.textContent="STATUS: SENDING...";

try{

const res = await fetch(API + "/api/render", {

method:"POST",

headers:{
"Content-Type":"application/json"
},

body:JSON.stringify({
templateID:templateID,
input:{prompt:prompt}
})

});

const data = await res.json();

if(!data.jobID){

statusBox.textContent="STATUS: ERROR";
console.error("Missing jobID",data);
return;

}

statusBox.textContent="STATUS: PROCESSING";

startPolling(data.jobID);

}catch(err){

console.error(err);
statusBox.textContent="STATUS: ERROR";

}

});

/* =================================================
POLLING
================================================= */

function startPolling(jobID){

const interval = setInterval(async()=>{

try{

const res = await fetch(API + "/api/status/" + jobID);
const data = await res.json();

if(data.status === "complete"){

clearInterval(interval);

statusBox.textContent="STATUS: COMPLETE";

if(data.url){

previewBox.innerHTML =
'<video controls autoplay src="'+data.url+'"></video>';

}

}

if(data.status === "error"){

clearInterval(interval);
statusBox.textContent="STATUS: ERROR";

}

}catch(e){

console.error(e);

}

},3000);

}

</script>

</body>
</html>
