<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<title>Create | SN Design Studio</title>

<link rel="stylesheet" href="https://sn-designstudio.dev/assets/css/master.css">
<link rel="stylesheet" href="https://sn-designstudio.dev/assets/css/create.css">

</head>
<body>

<div class="create-wrapper">

<h1 class="create-title">ULTRA GOD CREATE</h1>

<h3 id="engineLabel"></h3>

<input id="prompt" placeholder="Enter prompt">

<button id="createBtn">CREATE VIDEO</button>

<h3 id="status">STATUS: IDLE</h3>

<div id="preview"></div>

</div>

<script>

/* ===== CONFIG ===== */

const API = "https://api.sn-designstudio.dev";

/* ===== GET TEMPLATE ===== */

const params = new URLSearchParams(window.location.search);
const templateID = params.get("template");

document.getElementById("engineLabel").innerText =
"ENGINE: "+templateID;

if(!templateID){

document.getElementById("status").innerText =
"STATUS: NO TEMPLATE";

throw new Error("Template missing");

}

/* ===== CREATE BUTTON ===== */

document.getElementById("createBtn")
.addEventListener("click", async ()=>{

const prompt =
document.getElementById("prompt").value;

document.getElementById("status").innerText =
"STATUS: SENDING";

try{

const res = await fetch(API+"/api/render",{

method:"POST",
headers:{ "Content-Type":"application/json" },

body:JSON.stringify({

templateID:templateID,
input:{ prompt:prompt }

})

});

const data = await res.json();

if(!data.jobID) throw new Error("No jobID");

document.getElementById("status").innerText =
"STATUS: PROCESSING";

startPolling(data.jobID);

}catch(e){

document.getElementById("status").innerText =
"STATUS: ERROR";

}

});

/* ===== POLLING ===== */

function startPolling(jobID){

const interval = setInterval(async()=>{

const res =
await fetch(API+"/api/status/"+jobID);

const data = await res.json();

if(data.status==="complete"){

clearInterval(interval);

document.getElementById("status").innerText =
"STATUS: COMPLETE";

if(data.url){

document.getElementById("preview").innerHTML =
'<video controls autoplay src="'+data.url+'"></video>';

}

}

if(data.status==="error"){

clearInterval(interval);

document.getElementById("status").innerText =
"STATUS: ERROR";

}

},3000);

}

</script>

</body>
</html>
