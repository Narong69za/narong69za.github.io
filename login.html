<!-- ===================================================== -->
<!-- SN DESIGN STUDIO -->
<!-- FILE: login.html -->
<!-- VERSION: V3.2 FINAL AUTH REDIRECT FIX -->
<!-- STATUS: FINAL - GOOGLE LOGIN + JWT STORE + REDIRECT OK -->
<!-- DO NOT MODIFY WITHOUT AUTHORIZATION -->
<!-- ===================================================== -->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SN DESIGN LOGIN</title>

<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Arial,Helvetica,sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  flex-direction:column;
}
h1{
  letter-spacing:2px;
}
</style>
</head>

<body>

<h1>SN DESIGN LOGIN</h1>

<div id="g_id_onload"
     data-client_id="YOUR_GOOGLE_CLIENT_ID"
     data-callback="handleCredentialResponse"
     data-auto_prompt="false">
</div>

<div class="g_id_signin"
     data-type="standard"
     data-size="large"
     data-theme="outline"
     data-text="sign_in_with"
     data-shape="rectangular"
     data-logo_alignment="left">
</div>

<script>

// =====================================================
// VERSION LOCK
// =====================================================
const AUTH_VERSION = "V3.2 FINAL";

// =====================================================
// GOOGLE LOGIN HANDLER
// =====================================================
async function handleCredentialResponse(response){

  try{

    const res = await fetch("/api/auth/google",{
      method:"POST",
      headers:{
        "Content-Type":"application/json"
      },
      body:JSON.stringify({
        token: response.credential
      })
    });

    if(!res.ok){
      alert("Login failed");
      return;
    }

    const data = await res.json();

    // =====================================================
    // STORE JWT TOKEN
    // =====================================================
    if(data.token){
      localStorage.setItem("token", data.token);
    }else{
      alert("Token missing");
      return;
    }

    // =====================================================
    // VERIFY LOGIN SUCCESS
    // =====================================================
    const check = await fetch("/api/user/me",{
      headers:{
        Authorization: "Bearer " + localStorage.getItem("token")
      }
    });

    if(check.ok){
      window.location.href = "/templates.html";
    }else{
      localStorage.removeItem("token");
      alert("Auth verification failed");
    }

  }catch(err){
    console.error(err);
    alert("Login error");
  }

}

</script>

</body>
</html>
